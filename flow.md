# 결제 순서도

![부트페이 전체 결제 흐름도 (클라이언트 승인)](<.gitbook/assets/부트페이 시퀀스다이어그램1.png>)

## 결제 연동 작업 목록 **** (Client)

부트페이는 동일한 Client SDK로 모든 PG사, 결제수단을 호출합니다. 연동 작업에 필요한 목록을 확인하시고, 진행하시면 되겠습니다. 언어별 Client SDK의 결제연동 예시 및 자세한 설명은 [일반결제](client/pg/)의 하위메뉴를 참조하세요.



**1. Client SDK로 결제 요청**\
****`Bootpay.requestPayment`로 결제를 요청합니다. 요청시 포함되는 정보는 PG사 및 결제수단, 구매자, 상품 등의 결제정보로 부트페이가 해당 PG사에 결제생성을 요청하고, 결제창을 로딩합니다.

<details>

<summary>클라이언트 결제요청 API 목록</summary>

* [일반결제](client/pg/)
* [통합결제](client/total.md)
* [정기결제(인증)](client/subscription/undefined.md)
* [본인인증](client/auth.md)

</details>

****

**2. 결제 승인 요청**\
****결제 진행시, '결제 승인' 개념을 지원하는 PG사 이용시 클라이언트 SDK의 `confirm(data)` 함수가 실행됩니다. 재고 파악과 같은 내부적인 로직을 검증하신 후, 최종적으로 결제를 승인하길 원한다면 `Bootpay.confirm()`을 호출합니다.

<details>

<summary>'결제 승인' 지원 PG사 목록</summary>

* KCP
* 다날
* KG이니시스
* 나이스페이
* 토스페이먼츠
* 페이앱
* 이지페이
* TPay
* KG모빌리언스
* 웰컴페이먼츠
* 세틀뱅크&#x20;

</details>



**3. 결제 결과 수신** \
****결제완료 정보를 수신합니다. 결제수단, 결제완료 상태에 따라 다른 함수가 호출됩니다. 함수별 처리 예제나 자세한 설명은 [결제진행 이벤트](client/pg/web.md#undefined-1)를 참조해주세요.

<details>

<summary>done(data) - 결제 성공시 호출됨</summary>

결제성공시 호출되는 함수로, 이때 주문완료 페이지로 이동하시면 되겠습니다.&#x20;

한가지 유의해야 할 것은, 클라이언트의 결제데이터는 위변조가 가능하니 결제검증 과정이 필수로 필요합니다. 주문완료페이지에서 결제검증 후 상품을 지급하기를 추천합니다.

결제성공 데이터는 [Webhook](webhook/server.md)으로 통지됩니다.

</details>

<details>

<summary><strong>i</strong>ssued(data) - (가상계좌 전용) 가상계좌 발급성공시 호출됨</summary>

가상계좌 발급시 호출되는 함수로, 이때 주문완료(가상계좌 발급완료) 페이지로 이동하시면 되겠습니다.

고객이 발급받은 가상계좌 번호로 납부를 완료하면 [Webhook](webhook/server.md)으로 통지됩니다. 완료 전에는 가상계좌만 발급된 상태로, 실질적으로 결제가 진행된 상태는 아닙니다.

</details>

<details>

<summary>error(data) - 결제 실패시 호출됨</summary>

결제실패시 호출되는 함수로, 서비스를 이탈하지 않고 다시 결제를 진행할 수 있도록 안내하시면 되겠습니다. data에는 결제실패에 대한 사유가 포함되어 있으며, 부트페이에서 UI로 해당 사유를 노출합니다.

</details>

## 결제 연동 후 작업 (Server)

**4. Webhook 수신** \
****결제상태가 변경(승인완료/취소)되면 부트페이 서버로부터 통지를 받을 수 있습니다. 자세한 설명은 [webhook](webhook/server.md)을 참조해주세요.

****

**5. 결제 조회**\
****결제된 건에 대해서 정말 유효한 결제인지 서버간 통신을 통해 검증하셔야 합니다. 상세한 내용은 [결제 검증하기](server/verify.md)를 참조하세요



**6. 결제 취소하기**\
****필요시 전체취소, 부분취소를 요청할 수 있습니다. 부분취소는 취소요청시 price 값을 입력하면 되며, 상세한 내용은[ 결제 취소하기](server/cancel.md#undefined-15)를 참조하세요.



## 기술문의&#x20;

이 섹션에 대해 궁금하신 부분은 [채팅](https://bootpay.channel.io)으로 문의주시면 감사하겠습니다.&#x20;

